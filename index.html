<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Icon Set Gallery</title>
    <style>
        :root {
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --card-icon-bg: #ffffff;
            --text-color: #333333;
            --text-muted: #666666;
            --border-color: #e0e0e0;
            --hover-bg: #f0f0f0;
            --primary: #3b82f6;
            --primary-hover: #2563eb;
            --success: #10b981;
            --toast-bg: #1f2937;
        }

        [data-theme="dark"] {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --card-icon-bg: #ffffff;
            --text-color: #e5e5e5;
            --text-muted: #9ca3af;
            --border-color: #374151;
            --hover-bg: #1f2937;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
        }

        /* Header */
        .header {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .logo span {
            color: var(--text-color);
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        /* Theme toggle */
        .theme-toggle {
            background: var(--hover-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .theme-toggle svg {
            width: 20px;
            height: 20px;
            fill: var(--text-color);
        }

        /* Stats */
        .stats {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .stats strong {
            color: var(--primary);
        }

        /* PNG Size Selector */
        .png-size-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--hover-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.25rem 0.75rem;
        }

        .png-size-wrapper label {
            font-size: 0.875rem;
            color: var(--text-muted);
            white-space: nowrap;
        }

        #pngSize {
            padding: 0.4rem 0.6rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.8rem;
            background: var(--bg-color);
            color: var(--text-color);
            cursor: pointer;
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-wrapper {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-wrapper svg {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            fill: var(--text-muted);
        }

        #searchInput {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--bg-color);
            color: var(--text-color);
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        #searchInput:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .select-wrapper {
            position: relative;
        }

        .filter-select {
            padding: 0.75rem 2.5rem 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.875rem;
            background: var(--bg-color);
            color: var(--text-color);
            cursor: pointer;
            appearance: none;
            min-width: 150px;
        }

        .select-wrapper::after {
            content: '';
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            border: 5px solid transparent;
            border-top-color: var(--text-muted);
            pointer-events: none;
        }

        /* Main content */
        .main {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Icon grid */
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
        }

        .icon-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
            position: relative;
        }

        .icon-container-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
            position: relative;
        }

        .icon-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            border-color: var(--primary);
        }

        .icon-preview {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--card-icon-bg);
            border-radius: 8px;
        }

        .icon-preview svg {
            width: 100%;
            height: 100%;
        }

        .icon-name {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-align: center;
            word-break: break-word;
            line-height: 1.3;
            max-height: 2.6em;
            overflow: hidden;
        }

        .icon-type {
            font-size: 0.6rem;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Copy buttons overlay */
        .copy-buttons {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.85);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.2rem;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            padding: 0.5rem;
        }

        .icon-card:hover .copy-buttons {
            opacity: 1;
            visibility: visible;
        }

        .copy-btn {
            width: 100%;
            padding: 0.4rem 0.5rem;
            border: none;
            border-radius: 6px;
            font-size: 0.65rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.3rem;
        }

        .copy-btn:active {
            transform: scale(0.95);
        }

        .copy-btn.camel {
            background: #8b5cf6;
            color: white;
        }

        .copy-btn.camel:hover {
            background: #7c3aed;
        }

        .copy-btn.path {
            background: #3b82f6;
            color: white;
        }

        .copy-btn.path:hover {
            background: #2563eb;
        }

        .copy-btn.svg {
            background: #10b981;
            color: white;
        }

        .copy-btn.svg:hover {
            background: #059669;
        }

        .copy-btn.png {
            background: #f59e0b;
            color: white;
        }

        .copy-btn.png:hover {
            background: #d97706;
        }

        .copy-btn svg {
            width: 12px;
            height: 12px;
            fill: currentColor;
        }

        /* Loading state */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem;
            color: var(--text-muted);
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--border-color);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 4rem;
            color: var(--text-muted);
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            fill: var(--text-muted);
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--toast-bg);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast svg {
            width: 18px;
            height: 18px;
            fill: var(--success);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }

            .header-top {
                flex-direction: column;
                gap: 1rem;
            }

            .filters {
                flex-direction: column;
            }

            .search-wrapper {
                width: 100%;
            }

            .select-wrapper {
                width: 100%;
            }

            .filter-select {
                width: 100%;
            }

            .main {
                padding: 1rem;
            }

            .icon-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 0.75rem;
            }
        }

        /* Virtual scroll container */
        .virtual-container {
            position: relative;
        }

        .virtual-spacer {
            width: 100%;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="header-top">
                <div class="logo">Solar <span>Icon Set</span></div>
                <div class="header-actions">
                    <div class="png-size-wrapper">
                        <label for="pngSize">PNG Size</label>
                        <select id="pngSize">
                            <option value="24">24px</option>
                            <option value="32">32px</option>
                            <option value="48">48px</option>
                            <option value="64">64px</option>
                            <option value="128" selected>128px</option>
                            <option value="256">256px</option>
                            <option value="512">512px</option>
                            <option value="1024">1K</option>
                            <option value="2048">2K</option>
                            <option value="4096">4K</option>
                        </select>
                    </div>
                    <button class="theme-toggle" id="themeToggle" title="Toggle theme">
                        <svg class="sun-icon" viewBox="0 0 24 24"><path d="M12 3V4M12 20V21M4 12H3M6.31412 6.31412L5.5 5.5M17.6859 6.31412L18.5 5.5M6.31412 17.69L5.5 18.5M17.6859 17.69L18.5 18.5M21 12H20M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></svg>
                    </button>
                    <div class="stats" id="stats">Loading icons...</div>
                </div>
            </div>
            <div class="filters">
                <div class="search-wrapper">
                    <svg viewBox="0 0 24 24"><path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></svg>
                    <input type="text" id="searchInput" placeholder="Search icons... (e.g., arrow, home, user)">
                </div>
                <div class="select-wrapper">
                    <select id="typeFilter" class="filter-select">
                        <option value="">All Types</option>
                    </select>
                </div>
                <div class="select-wrapper">
                    <select id="categoryFilter" class="filter-select">
                        <option value="">All Categories</option>
                    </select>
                </div>
            </div>
        </div>
    </header>

    <main class="main">
        <div id="iconGrid" class="icon-grid">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading icons...</p>
            </div>
        </div>
    </main>

    <div class="toast" id="toast">
        <svg viewBox="0 0 24 24"><path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></svg>
        <span id="toastMessage">Copied!</span>
    </div>

    <script>
        // State
        let manifest = null;
        let filteredIcons = [];
        let svgCache = new Map();
        let visibleRange = { start: 0, end: 100 };
        let debounceTimer = null;
        
        // DOM elements
        const iconGrid = document.getElementById('iconGrid');
        const searchInput = document.getElementById('searchInput');
        const typeFilter = document.getElementById('typeFilter');
        const categoryFilter = document.getElementById('categoryFilter');
        const pngSizeSelect = document.getElementById('pngSize');
        const themeToggle = document.getElementById('themeToggle');
        const stats = document.getElementById('stats');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');

        // Convert path to camelCase
        function toCamelCase(path) {
            // Remove 'icons/' prefix and '.svg' extension
            const cleanPath = path.replace(/^icons\//, '').replace(/\.svg$/, '');
            // Split by / and _
            const parts = cleanPath.split(/[/_]/);
            // Convert to camelCase
            return parts.map((part, i) => {
                if (i === 0) return part.toLowerCase();
                return part.charAt(0).toUpperCase() + part.slice(1).toLowerCase();
            }).join('');
        }

        // Show toast notification
        function showToast(message) {
            toastMessage.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        // Copy to clipboard
        async function copyToClipboard(text, type) {
            try {
                await navigator.clipboard.writeText(text);
                showToast(`${type} copied!`);
            } catch (err) {
                console.error('Copy failed:', err);
                showToast('Copy failed');
            }
        }

        // Fetch and cache SVG
        async function fetchSvg(path) {
            if (svgCache.has(path)) {
                return svgCache.get(path);
            }
            try {
                const response = await fetch(path);
                const svg = await response.text();
                svgCache.set(path, svg);
                return svg;
            } catch (err) {
                console.error('Failed to fetch SVG:', err);
                return null;
            }
        }

        // Convert SVG to PNG and copy to clipboard
        async function copyAsPng(svgString, size) {
            return new Promise((resolve, reject) => {
                // Create a canvas
                const canvas = document.createElement('canvas');
                canvas.width = size;
                canvas.height = size;
                const ctx = canvas.getContext('2d');
                
                // Create an image from SVG
                const img = new Image();
                
                // Modify SVG to set explicit size
                let modifiedSvg = svgString;
                // Update or add width/height attributes
                if (modifiedSvg.includes('width="')) {
                    modifiedSvg = modifiedSvg.replace(/width="[^"]*"/, `width="${size}"`);
                } else {
                    modifiedSvg = modifiedSvg.replace('<svg', `<svg width="${size}"`);
                }
                if (modifiedSvg.includes('height="')) {
                    modifiedSvg = modifiedSvg.replace(/height="[^"]*"/, `height="${size}"`);
                } else {
                    modifiedSvg = modifiedSvg.replace('<svg', `<svg height="${size}"`);
                }
                
                const svgBlob = new Blob([modifiedSvg], { type: 'image/svg+xml;charset=utf-8' });
                const url = URL.createObjectURL(svgBlob);
                
                img.onload = async () => {
                    // Draw white background for transparency
                    ctx.fillStyle = 'transparent';
                    ctx.fillRect(0, 0, size, size);
                    
                    // Draw the SVG
                    ctx.drawImage(img, 0, 0, size, size);
                    URL.revokeObjectURL(url);
                    
                    try {
                        // Convert to blob and copy to clipboard
                        canvas.toBlob(async (blob) => {
                            if (blob) {
                                try {
                                    await navigator.clipboard.write([
                                        new ClipboardItem({ 'image/png': blob })
                                    ]);
                                    resolve(true);
                                } catch (clipErr) {
                                    // Fallback: download the file
                                    const link = document.createElement('a');
                                    link.download = `icon-${size}px.png`;
                                    link.href = URL.createObjectURL(blob);
                                    link.click();
                                    URL.revokeObjectURL(link.href);
                                    resolve(true);
                                }
                            } else {
                                reject(new Error('Failed to create blob'));
                            }
                        }, 'image/png');
                    } catch (err) {
                        reject(err);
                    }
                };
                
                img.onerror = () => {
                    URL.revokeObjectURL(url);
                    reject(new Error('Failed to load SVG'));
                };
                
                img.src = url;
            });
        }

        // Create icon card HTML
        function createIconCard(icon) {
            const card = document.createElement('div');
            card.className = 'icon-card';
            card.dataset.path = icon.path;
            
            card.innerHTML = `
                <div class="icon-preview" data-path="${icon.path}"></div>
                <div class="icon-type">${icon.type.replace('_', ' ')}</div>
                <div class="icon-name">${icon.name.replace(/_/g, ' ')}</div>
                <div class="copy-buttons">
                    <button class="copy-btn camel" data-action="camel" title="Copy as camelCase">
                        <svg viewBox="0 0 24 24"><path d="M8 5H6C4.89543 5 4 5.89543 4 7V19C4 20.1046 4.89543 21 6 21H18C19.1046 21 20 20.1046 20 19V7C20 5.89543 19.1046 5 18 5H16M8 5V3H16V5M8 5H16" stroke="currentColor" stroke-width="2" fill="none"/></svg>
                        CamelCase
                    </button>
                    <button class="copy-btn path" data-action="path" title="Copy path">
                        <svg viewBox="0 0 24 24"><path d="M8 5H6C4.89543 5 4 5.89543 4 7V19C4 20.1046 4.89543 21 6 21H18C19.1046 21 20 20.1046 20 19V7C20 5.89543 19.1046 5 18 5H16M8 5V3H16V5M8 5H16" stroke="currentColor" stroke-width="2" fill="none"/></svg>
                        Path
                    </button>
                    <button class="copy-btn svg" data-action="svg" title="Copy SVG code">
                        <svg viewBox="0 0 24 24"><path d="M8 5H6C4.89543 5 4 5.89543 4 7V19C4 20.1046 4.89543 21 6 21H18C19.1046 21 20 20.1046 20 19V7C20 5.89543 19.1046 5 18 5H16M8 5V3H16V5M8 5H16" stroke="currentColor" stroke-width="2" fill="none"/></svg>
                        SVG Code
                    </button>
                    <button class="copy-btn png" data-action="png" title="Copy as PNG">
                        <svg viewBox="0 0 24 24"><path d="M4 16L8.586 11.414C9.367 10.633 10.633 10.633 11.414 11.414L16 16M14 14L15.586 12.414C16.367 11.633 17.633 11.633 18.414 12.414L20 14M14 8H14.01M6 20H18C19.1046 20 20 19.1046 20 18V6C20 4.89543 19.1046 4 18 4H6C4.89543 4 4 4.89543 4 6V18C4 19.1046 4.89543 20 6 20Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></svg>
                        PNG
                    </button>
                </div>
            `;

            // Event handlers for copy buttons
            card.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    e.stopPropagation();
                    const action = btn.dataset.action;
                    
                    if (action === 'camel') {
                        copyToClipboard(toCamelCase(icon.path), 'CamelCase name');
                    } else if (action === 'path') {
                        copyToClipboard(icon.path, 'Path');
                    } else if (action === 'svg') {
                        const svg = await fetchSvg(icon.path);
                        if (svg) {
                            copyToClipboard(svg, 'SVG code');
                        }
                    } else if (action === 'png') {
                        const svg = await fetchSvg(icon.path);
                        if (svg) {
                            const size = parseInt(pngSizeSelect.value);
                            try {
                                await copyAsPng(svg, size);
                                showToast(`PNG (${size}px) copied!`);
                            } catch (err) {
                                console.error('PNG copy failed:', err);
                                showToast('PNG copy failed - downloaded instead');
                            }
                        }
                    }
                });
            });

            return card;
        }

        // Load icon preview with Intersection Observer
        function loadIconPreview(preview) {
            const path = preview.dataset.path;
            if (preview.dataset.loaded) return;
            
            fetchSvg(path).then(svg => {
                if (svg) {
                    preview.innerHTML = svg;
                    preview.dataset.loaded = 'true';
                }
            });
        }

        // Intersection Observer for lazy loading
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const preview = entry.target.querySelector('.icon-preview');
                    if (preview && !preview.dataset.loaded) {
                        loadIconPreview(preview);
                    }
                }
            });
        }, {
            rootMargin: '100px',
            threshold: 0
        });

        // Render icons
        function renderIcons() {
            iconGrid.innerHTML = '';
            
            if (filteredIcons.length === 0) {
                iconGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <svg viewBox="0 0 24 24"><path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="currentColor" stroke-width="2" fill="none"/></svg>
                        <h3>No icons found</h3>
                        <p>Try adjusting your search or filters</p>
                    </div>
                `;
                return;
            }

            // Use document fragment for better performance
            const fragment = document.createDocumentFragment();
            
            // Limit initial render for performance, load more on scroll
            const iconsToRender = filteredIcons.slice(0, 200);
            
            iconsToRender.forEach(icon => {
                const card = createIconCard(icon);
                observer.observe(card);
                fragment.appendChild(card);
            });

            iconGrid.appendChild(fragment);
            
            // Load more on scroll
            if (filteredIcons.length > 200) {
                const loadMoreObserver = new IntersectionObserver((entries) => {
                    if (entries[0].isIntersecting) {
                        loadMoreObserver.disconnect();
                        loadMoreIcons(200);
                    }
                });
                
                const sentinel = document.createElement('div');
                sentinel.style.height = '1px';
                sentinel.style.gridColumn = '1 / -1';
                iconGrid.appendChild(sentinel);
                loadMoreObserver.observe(sentinel);
            }
        }

        // Load more icons progressively
        function loadMoreIcons(startIndex) {
            const batchSize = 200;
            const endIndex = Math.min(startIndex + batchSize, filteredIcons.length);
            const fragment = document.createDocumentFragment();
            
            for (let i = startIndex; i < endIndex; i++) {
                const card = createIconCard(filteredIcons[i]);
                observer.observe(card);
                fragment.appendChild(card);
            }
            
            // Remove sentinel before adding new icons
            const oldSentinel = iconGrid.querySelector('div[style*="height: 1px"]');
            if (oldSentinel) oldSentinel.remove();
            
            iconGrid.appendChild(fragment);
            
            // Add new sentinel if more icons remain
            if (endIndex < filteredIcons.length) {
                const loadMoreObserver = new IntersectionObserver((entries) => {
                    if (entries[0].isIntersecting) {
                        loadMoreObserver.disconnect();
                        loadMoreIcons(endIndex);
                    }
                });
                
                const sentinel = document.createElement('div');
                sentinel.style.height = '1px';
                sentinel.style.gridColumn = '1 / -1';
                iconGrid.appendChild(sentinel);
                loadMoreObserver.observe(sentinel);
            }
        }

        // Filter icons
        function filterIcons() {
            const search = searchInput.value.toLowerCase().trim();
            const type = typeFilter.value;
            const category = categoryFilter.value;
            
            filteredIcons = manifest.icons.filter(icon => {
                if (type && icon.type !== type) return false;
                if (category && icon.category !== category) return false;
                if (search) {
                    const searchTerms = search.split(/\s+/);
                    const iconText = `${icon.name} ${icon.category} ${icon.type}`.toLowerCase();
                    return searchTerms.every(term => iconText.includes(term));
                }
                return true;
            });
            
            updateStats();
            renderIcons();
        }

        // Debounced filter
        function debouncedFilter() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(filterIcons, 150);
        }

        // Update stats
        function updateStats() {
            stats.innerHTML = `Showing <strong>${filteredIcons.length.toLocaleString()}</strong> of <strong>${manifest.icons.length.toLocaleString()}</strong> icons`;
        }

        // Populate filter dropdowns
        function populateFilters() {
            manifest.types.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                typeFilter.appendChild(option);
            });
            
            manifest.categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                categoryFilter.appendChild(option);
            });
        }

        // Theme toggle
        function initTheme() {
            const saved = localStorage.getItem('theme');
            if (saved === 'dark' || (!saved && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.body.dataset.theme = 'dark';
            }
        }

        themeToggle.addEventListener('click', () => {
            const isDark = document.body.dataset.theme === 'dark';
            document.body.dataset.theme = isDark ? '' : 'dark';
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
        });

        // Event listeners
        searchInput.addEventListener('input', debouncedFilter);
        typeFilter.addEventListener('change', filterIcons);
        categoryFilter.addEventListener('change', filterIcons);

        // Initialize
        async function init() {
            try {
                const response = await fetch('manifest.json');
                manifest = await response.json();
                
                filteredIcons = manifest.icons;
                
                populateFilters();
                updateStats();
                renderIcons();
                initTheme();
            } catch (err) {
                console.error('Failed to load manifest:', err);
                iconGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <svg viewBox="0 0 24 24"><path d="M12 9V11M12 15H12.01M5.07183 19H18.9282C20.4678 19 21.4301 17.3333 20.6603 16L13.7321 4C12.9623 2.66667 11.0377 2.66667 10.2679 4L3.33975 16C2.56995 17.3333 3.53223 19 5.07183 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></svg>
                        <h3>Failed to load icons</h3>
                        <p>Make sure to run <code>node build-manifest.js</code> first to generate the manifest.</p>
                    </div>
                `;
            }
        }

        init();
    </script>
</body>
</html>
